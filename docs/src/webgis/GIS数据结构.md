# GIS 数据结构

GIS 的数据结构分为 矢量数据结构、栅格数据结构、混合数据结构。

## 矢量数据

矢量文件：矢量数据是通过`点、线、面等几何对象`来表示地理空间信息的数据类型。`矢量文件的特点是精度高、存储空间小，适合表示具有明确边界的地理要素`。例如：道路、河流、行政区等。
::: info 点线面

- 点(point)。用于表示离散的地理位置。如城市、井、标志等
- 线(Polyline)。用于表示线性地理要素。如河流、道路等
- 面(Polygon)。用于表示封闭区域。如湖泊、建筑物等
  :::

  ![点线面](/images/gis/点线面.jpg)

### 矢量数据的存储方式

这里以 Shapefile 的存储方式为例。shapefile 是 Esri 提出的一种矢量数据存储格式，主要用于点线面等空间数据的存储。Shapefile 由多个文件组成，其中至少包括 3 个主要文件和其他的可选文件：

- .shp。存储矢量几何数据，点、线、面等
- .shx。存储几何索引，提高访问速度
- .dbf。存储属性表数据，数据库格式、dBASE 等
- .prj。存储投影坐标系统信息(WKT 格式)。
- .sbn、.sbx。空间索引文件，提高查询速度，如 roads.sbn / roads.sbx
- .cpg。指定.dbf 文件的字符编码
- .xml。存储元数据，描述数据来源、创建时间等，如 roads.xml

### 矢量文件的格式：

- Shapefile(SHP)：是最常用的矢量数据格式。包含`.shp(几何)`、`.shx(索引)`、`.dbf(属性)`，支持点、线、面等多种几何类型。
- GeoJSON：基于 JSON 的轻量级数据格式，适合 Web 地图应用。
- KML\KMZ：google Earth 使用的矢量数据格式，支持点线面等几何类型，常用语地理信息的可视化。
- GML：基于 XML 的地理数据格式，具有较强的扩展性和兼容性。
- DXF、DWG：用于 CAD 软件的矢量数据格式，也可以在 GIS 中使用，常用于建筑和工程领域。
- GPX：用于 GPS 设备的轨迹数据格式，支持点和线。
  ![矢量数据](/images/gis/矢量数据模型.png)

## 栅格数据

栅格数据：`栅格数据是通过规则的网格也叫做像元来表示地理空间信息的数据类型`。每个像元包含一个值，表示该位置的某种属性如高程、地表温度、土地覆盖类型等。`栅格数据的特点是处理速度快，适合进行空间分析和模拟`，适用于遥感影像、地形数据等。

- 像元：栅格数据的基本单位，每个像元具有一个值。
- 栅格数据的类型：

  - 连续栅格数据：像元值在空间上是连续变化的，常应用于 DEM、坡度、温度分布等；
  - 离散栅格数据：像元值表示分类信息，空间上不连续。常用于土地利用分类、植被类型、土壤类别等。

### 栅格数据的类型

- GeoTIFF：支持地理坐标信息的 TIFF 文件，是最常用的栅格数据格式，支持地理信息如坐标投影等，广泛应用于遥感和 GIS 领域。
- JPEG2000：压缩栅格数据格式，适用于大规模遥感数据。
- ERDAS IMG： .img。由 ERDAS 软件使用的栅格数据格式，支持多种数据类型。
- ArcGRID： .adf。Esri 软件的数据格式，常用于 ArcGIS 软件
- HDF：用于存储大规模数据的格式，常用于遥感数据
- NetCDF：用于存储多为数据的格式，常用于气象和海洋数据
- BMP、JPG、PNG。常见的图像格式，也可用于栅格数据的存储，但通常不包含地理信息，需要额外的坐标文件来标注。

![栅格数据](/images/gis/栅格数据模型.png)

### 要素转栅格

要素转栅格是地理信息系统中的一种数据转换操作，`指的是将矢量数据，如点、线、面等转换为栅格数据，规则的网格`。这个过程会根据矢量要素的几何形状和属性信息，生成一个栅格数据集，栅格中的每个像元（要素）表示该位置的某种属性值。

### 要素转栅格的含义

- 矢量数据： 以点线面的形式表示地理要素信息，具有明确的几何形状和属性信息。
- 栅格数据： 以规则的网格形式表示地理空间，每个像元包含一个值，表示该位置的某种属性。
- 转换过程：将矢量要素的几何形状和属性信息映射到栅格数据中，生成一个栅格化的地理空间数据集。

##### 转换的过程

1. 选择矢量数据：确定要转换的矢量数据，点线面等
2. 定义栅格分辨率：设置栅格的像元大小，决定栅格数据的精度
3. 选择属性字段：指定矢量数据中的某个属性字段作为栅格像元的值。
4. 栅格化算法：根据矢量要素的几何形状和属性值，将矢量数据映射到栅格数据中。
   常见的算法包括：
   - 点要素：将点的位置映射到最近的像元
   - 线要素：将线段覆盖的像元赋予相应的属性值
   - 面要素：将面要素内的所有像元赋予相同的属性值。
5. 生成栅格数据：输出栅格数据文件，通常为 GeoTIFF 等格式。

#### 应用场景

1. 土地利用分类：将土地利用的矢量多边形（如农田、城市、森林）转换为栅格数据，便于进行土地覆盖分析。

2. 地形分析：将等高线（线要素）转换为数字高程模型（DEM）。

3. 环境分析：将监测站点（点要素）的数据（如空气质量、土壤湿度）栅格化，生成连续的环境变量分布图。

4. 城市规划：将城市道路网络（线要素）或建筑物轮廓（面要素）转换为栅格数据，用于城市热岛效应分析或交通流量模拟。

5. 生态研究：将栖息地范围（面要素）或物种分布点（点要素）栅格化，分析生态系统的空间分布

#### 要素转栅格的优缺点

##### 优点

- 数据统一：将矢量数据转换为栅格数据后，便于与其他栅格数据进行统一分析。

- 便于分析：栅格数据适合进行空间分析（如地形分析、缓冲区分析、叠加分析等）。

- 可视化方便：栅格数据可以直接用于生成连续的地理现象分布图。

##### 缺点

- 数据丢失：矢量数据的几何精度较高，转换为栅格数据后，精度会受到像元大小的限制。

- 数据膨胀：栅格数据的存储空间通常比矢量数据大，尤其是高分辨率的栅格数据。

- 计算复杂度：栅格数据的处理速度虽然较快，但处理大规模数据时仍可能需要较高的计算资源。

## 栅格数据和矢量数据的对比

### **1. 数据结构**

| **特性**     | **栅格数据**                          | **矢量数据**                           |
| ------------ | ------------------------------------- | -------------------------------------- |
| **基本单元** | 像素（Pixel）或像元（Cell）组成的矩阵 | 几何对象（点、线、面）及其属性         |
| **数据表示** | 网格化的数值阵列（如高程、颜色值）    | 数学坐标定义的几何形状（如经纬度坐标） |
| **示例**     | 卫星影像、DEM、照片、温度分布图       | 行政区边界、道路网络、POI 点           |

---

### **2. 存储与计算**

| **特性**     | **栅格数据**                           | **矢量数据**                             |
| ------------ | -------------------------------------- | ---------------------------------------- |
| **存储方式** | 按行列存储每个像素的值（如 RGB、高程） | 存储顶点坐标和拓扑关系（如线的起点终点） |
| **文件格式** | GeoTIFF、JPEG、PNG、NetCDF、HDF        | Shapefile、GeoJSON、KML、DXF、SHP        |
| **计算效率** | 适合网格化分析（如地形分析、图像处理） | 适合几何运算（如缓冲区分析、叠加分析）   |

---

### **3. 精度与分辨率**

| **特性**     | **栅格数据**                           | **矢量数据**                   |
| ------------ | -------------------------------------- | ------------------------------ |
| **精度**     | 依赖分辨率（像素大小），放大后可能失真 | 数学定义，无限缩放不丢失精度   |
| **分辨率**   | 高分辨率数据占用存储空间大             | 与缩放无关，存储效率高         |
| **细节表现** | 适合连续现象（如温度、高程）           | 适合离散对象（如建筑物、道路） |

---

### **4. 适用场景**

| **场景**     | **栅格数据**                     | **矢量数据**                       |
| ------------ | -------------------------------- | ---------------------------------- |
| **典型应用** | 遥感影像分析、地形建模、气象数据 | 地图制图、导航路径规划、CAD 设计   |
| **优势领域** | 连续场数据、图像处理、机器学习   | 精确边界、拓扑关系、属性查询       |
| **劣势**     | 边界模糊、属性单一               | 复杂连续现象（如高程）需大量矢量面 |

---

### **5. 可视化对比**

| **特性**     | **栅格数据**                     | **矢量数据**                   |
| ------------ | -------------------------------- | ------------------------------ |
| **显示效果** | 像素化（放大后出现马赛克）       | 平滑几何图形（无限缩放无锯齿） |
| **渲染速度** | 大数据量时较慢（需处理全部像素） | 高效（仅渲染可见对象）         |

---

### **6. 相互转换**

- **栅格 → 矢量**：通过 **矢量化**（如边缘检测、分类提取）生成点、线、面。  
  **工具**：ArcGIS（Raster to Polygon）、QGIS（GDAL）、深度学习分割模型。
- **矢量 → 栅格**：通过 **栅格化**（如采样、插值）转换为像素矩阵。  
  **工具**：ArcGIS（Feature to Raster）、Python（rasterio）。

---

### **7. 选择依据**

| **选择栅格数据**             | **选择矢量数据**         |
| ---------------------------- | ------------------------ |
| 需要表示连续现象（如降雨量） | 需要精确边界或拓扑关系   |
| 分析基于网格（如坡度计算）   | 频繁编辑几何形状或属性   |
| 数据源本身为影像/扫描图      | 需高效存储和渲染离散对象 |

---

### **8. 技术示例**

- **栅格数据代码（Python）**
  ```python
  import rasterio
  # 读取GeoTIFF栅格数据
  with rasterio.open("elevation.tif") as src:
      elevation = src.read(1)  # 获取高程矩阵
  ```
- **矢量数据代码（GeoJSON）**
  ```json
  {
    "type": "Feature",
    "geometry": {
      "type": "Polygon",
      "coordinates": [
        [
          [116.3, 39.9],
          [116.3, 40.0],
          [116.4, 40.0]
        ]
      ]
    },
    "properties": { "name": "北京市" }
  }
  ```

---
