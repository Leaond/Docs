# 空间数据库

## 数据和数据库

`数据`是描述事物的符号记录，可以是数字形式，也可以是文字、图形、图像、声音、语言等多种表现形式。人们收集并抽取出应用所需的大量数据后，将其保存起来以供进一步加工处理，抽取有用的信息。

`数据库`是长期存储在计算机内的、有组织的、可共享的数据集合。数据库中的数据按一定的数据模型组织、描述和存储，具有较小的冗余度、较高的数据独立性和易扩展性，并可为各种用户共享。

常用的数据模型：层次模型、网状模型、关系模型、面向对象模型。

其中 `层次模型和网状模型统称为非关系模型`。非关系模型的数据系统在 20 世纪 70 年代到 80 年代非常流行，在数据库系统产品中占据了主导地位，现在已逐渐被关系模型的数据库系统取代。
![三维边界表示法](/images/geometry/5-空间数据库/img55.png)

### 层次数据库模型

![三维边界表示法](/images/geometry/5-空间数据库/img56.png)
他的特点是将数据组织成一对多关系的结构。层次结构采用关键字来访问其中每一层次的每一部分。层次数据库结构特别适用于文献目录、土壤分类、部门机构等分级数据的组织。

优点：层次模型中各数据之间构成一种依次的、从上到下的层次关系，层次清楚，数据存取、检索方便。

缺点：

- 不能表示多对多的联系，结构缺乏灵活性
- 在 GIS 中，不能顾及公共点、线数据共享和实体元素间的拓扑关系；
- 需要采用大量的索引文件
- 实体元素重复存储，导致大量的冗余数据

### 网状数据库模型

网络模型用链接指令或指针来确定数据间的显式链接关系，是具有多对多类型的数据组织方式。
![三维边界表示法](/images/geometry/5-空间数据库/img57.png)

网状数据库模型的特点：采用双向指针来表示数据间的连接关系，可表示多对多关系

优点：

- 网络模型类似于拓扑数据模型，可表示相邻的图形特征
- 在复杂的拓扑结构中搜索，双向环路指针很有效
- 避免哦了数据冗余

缺点：

- 间接的指针占用大量存贮空间
- 数据更新时，指针也需要变化，其建立和维护困难

### 关系数据库模型

关系数据库模型师以记录组货数据表的形式组织数据，以便于利用各种地理实体与属性之间的关系进行存储和变换，不分层也不指针，是建立空间数据和属性数据之间关系的一种非常有效的数据组织方式。
![关系数据库模型](/images/geometry/5-空间数据库/img58.png)

关系数据库模型的特点
他把数据的逻辑结构归结为满足一定条件的二维表中的元素，关系表通过共同的特征联系起来。

优点：

- 对实体描述具有一致性，不需指针
- 结构灵活，易于理解和维护
- 可以用不二罗就运算和数学运算来操作数据

缺点：

- 操作要求在文件中顺序查找满足特定关系的数据，当数据库庞大时，效率降低
- 模型扩充困难

### 面向对象数据库模型

GIS 中的地物可根据国家分类标准货世纪情况划分类型。如一个大学 GIS 的对象可分为建筑物、道路、绿化等几类，地物类型的每一个大类又可以进一步分类，另一方面年，几种具有相同属性和操作的类型可总和为超类。
![关系数据库模型](/images/geometry/5-空间数据库/img59.png)

## 空间数据库

空间数据库（GeoDataBase）是某一区域内关于一定地理要素特征的数据集合，是地理信息系统在计算机物理存储介质存储的与应用相关的地理空间数据的总和，一般是以一系列特定结构的文件的形式组织在存储介质之上的。
![关系数据库模型](/images/geometry/5-空间数据库/img60.png)

`空间数据库的特点：数据量特别大、数据结构复杂、数据关系多样、数据应用广泛。`

空间数据库的组成：空间数据库的组成从类型上分有`栅格数据库和矢量数据库`两类。其中`栅格数据包括航空遥感影像数据和 DEM 数据`；`矢量数据则包括各种空间实体数据（图形和属性数据`）.

### 空间数据库设计内容

数据库设计是指对于一个给定的应用环境，构造最优的数据库模式，简历数据库及其应用系统，使之能够有效的存储数据，满足各种用户的应用需求。

由于空间数据本身的特征，导致空间数据库的设计与传统数据库设计存在巨大的差异。良好的空间数据库设计，对于数据库的数据存储结构、存取效率等方面具有重要影响。因此对各 GIS 设计目标和方法有一个基本的了解至关重要。进行地理数据库设计，需要先确定要使用的数据专题，然后再指定各专题图层的内容和表现形式。

相比传统数据库，在空间数据库的设计阶段，主要包括以下几个方面的内容

- 选择数据模型与划分地理实体
- 确定数据实体属性与空间结构
- 实现丰富的地理实体行为
- 属性关系及完整性约束

### 空间数据库设计步骤

空间数据库的设计是一个负责的过程。其设计步骤主要包括以下几个方面:

1. 确定业务需求与目标信息产品
2. 根据信息需求，确定主要数据专题
3. 指定比例范围以及每个数据专题在每个比例下的空间表示
4. 将各种表示形式分解为一个或多个地理数据集合
5. 为描述性的属性定义表格型数据库结构和行为
6. 定义数据集的空间行为、空间关系和完整性规则
7. 构建可用的原型，查看优化设计测试原型设计
8. 记录地理数据库设计

### 空间数据的基本特征

- 空间特征
- 非结构化特征
- 空间关系特征
- 多尺度与多态性
- 分类编码特征
- 海量数据特征

由于空间数据存在非结构化特征、空间关系特征，使得通用数据库管理系统在管理空间数据时，面临较多问题:

1. GIS 需要一些复杂的图形功能，一般的 DBMS 不能支持
2. DBMS 一般都难以实现对空间数据的关联、连通、包含、叠加等基本操作
3. 地理信息表达复杂，表示搭那个地理实体需要多个文件、多条记录，一般的 DBMS 也难以支持、
4. 具有高度内部联系的 GIS 数据记录需要更复杂的安全性维护系统。一般的 DBMS 都难以保证
5. GIS 中空间数据记录是变长的（存储的坐标点的数目随控件对象的变化而变化），而一般数据库都只允许把记录的长度设定为固定长度

## 空间数据的组织

### 空间数据的分层组织

将表示同一地理范围内总舵地理要素和地理现象的空间数据采用分层方式进行数据组织，这是一种起源于地图制图的空间数据组织方式，在分层数据组织中，图层咳根据地理事物或地理现象的分类，按照数据类型（矢量、栅格、影像等）、专题内容、要素几何类别（点、线、面）、时间次序等设定。
![关系数据库模型](/images/geometry/5-空间数据库/img61.png)
![关系数据库模型](/images/geometry/5-空间数据库/img62.png)
![关系数据库模型](/images/geometry/5-空间数据库/img63.png)

优点：

- 这种方式是目前颇为普遍的数据组织方法，方便使用者选择合适的数据，适合与栅格或矢量数据结构，目前大多数 GIS 软件采用这一方法。
  缺点
- 缺点是层与层之间的数据必须经过层叠置处理才能关联在一起，在叠置处理中，对栅格数据常需要大量存储空间来完成操作，而矢量数据则需大量的计算处理
- 同一图层内的图形数据的空间关系较为简单并易于处理，但不同图层之间的空间关系难以处理。

### 空间数据的分块组织

当对大范围区域内众多类型空间数据进行存储和管理时，为了提高数据存储与管理的效率，可将空间数据所覆盖的区域范围分割为若干块或分区，按块分别进行空间数据的组织，块可以是规则的，也可以是不规则的。

优点：

- 分区式与分层可同时采用，并不冲突。
- 分区式也是目前大部分商业软件采用的方法，适合与栅格和矢量数据结构，在数据量大的系统中，分区方法可提高数据存取的效率。

缺点：图幅或区块间的衔接问题是分区法最大的困扰，尤其在空间数据查询、分析操作时更是这样。

### 空间数据的无缝组织

为了克服空间数据分幅或分块组织时，导致对跨越多个图幅或分块地理要素的割裂或不一致，从而难以查询和分析等问题，在涉及大范围、海量空间数据的数据组织时，通常采用连续、无缝的数据组织形式，以满足用户任意和透明的访问和操作数据的要求。

无缝空间数据组织有 3 种实现途径：几何无缝、逻辑无缝和物理无缝的各分幅或分块表示的地理要素都转换到该坐标框架下并进行几何接边处理。
![关系数据库模型](/images/geometry/5-空间数据库/img64.png)

### 多尺度空间数据组织

从理论上来说，在对现实世界的数字化表达中，不存在比例尺的概念，但从观察、理解及制图的角度来看，当涉及大范围区域时，往往需要从宏观到微观，以不同的层次细节来刻画地理要素，这就要求必须建立多尺度或多比例尺空间数据库。
![关系数据库模型](/images/geometry/5-空间数据库/img65.png)
目的是可视化需要和应对不同的需要。

### 属性数据的组织

属性数据由关系数据库管理系统管理，但他的文件组织方式也要服从上述工作层、工作区和图库的要求，以便于图形文件协调工作，共同组成共工作区、工作层，并进行跨图幅操作。在不同的商业化软件中，属性文件组织方式各不相同。主要的 3 中方式如下：

1. 与工作层对应的组织方式
2. 与地物类对应的组织方式
3. 混合方式

## 数据的管理

### 矢量数据的管理

1. 文件-关系数据库混合管理
   由于空间数据的非结构化特征，早起关系型数据库难以满足空间数据管理的要求。因此，传统 GIS 软件采用文件与关系数据库混合方式管理空间数据，比较典型的是 ArcInfo，有的系统也采用纯文件方式管理空间数据，如 MapInfo；即用文件系统管理几何图形数据，用商用关系型数据库管理属性数据，两者之间通过目标标识或内部链接吗进行链接
   ![关系数据库模型](/images/geometry/5-空间数据库/img66.png)

2. 全关系数据库混合管理
   全关系数据库管理方式下，图形数据与属性数据都采用现有的关系型数据库存储，使用关系数据库标准连接机制来进行空间数据与属性数据的链接。对于变长数据采用定长记录的数据表或者处理成二进制字段进行存储。
   ![关系数据库模型](/images/geometry/5-空间数据库/img67.png)

3. 对象-关系数据库管理
   由于直接采用通用的关系数据库管理系统的效率不高，而非结构化的空间数据又十分重要，所以许多数据库管理系统的软件商在关系数据库管理系统中进行扩展，是指能直接存储和管理非结构化的空间数据。如 Informix 和 Oracle 等都推出了空间数据管理的专用模块，定义了曹总点、线面等控件对象的 API 函数。这些函数，将各种中间对象的数据结构进行了预先的定义。

### 栅格数据的管理

1. 文件管理方式
   目前大部分 GIS 软件和遥感图像处理软件都是采用文件方式来管理遥感影像数据。由于遥感影像数据库并不是仅仅包含图像数据本身，而且还包含大量的图像元数据信息（如图像类型、摄影日期、摄影比例尺等），遥感图像数据本身还具有多数据源、多时相等特点，另外，数据的安全性、并发控制和数据共享等都将文件管理无法应对。
   ![关系数据库模型](/images/geometry/5-空间数据库/img68.png)

2. 文件-数据库管理方式
   为了改进文件方式管理影像数据的效率，一种新的管理方式被提出来：文件+数据库管理方式。实施这种方式管理影像数据时，影像数据仍按照文件方式组织管理；在关系数据库中，每个文件都有唯一的标识号对应影像信息，如文件名字、存储路径等。

3. 关系数据库管理
   由于关系数据库发展成熟，具有良好的安全措施和数据恢复机制；目前关系数据库系统提供了存储复杂数据类型的能力，使利用关系数据库来管理影像数据成为可能。基于扩展关系数据库的影像数据库管理时将影像数据存储在二进制变长字段中，然后应用程序通过数据访问接口来访问数据库中的影像数据。同时影像数据的元数据信息存放在关系数据库的表中，二者可以进行无缝管理。

## 关系数据库管理的的点

- 所有数据集中存储，数据安全，易于共享
- 较方便管理多数据源和多失态的数据
- 支持事务处理和并发控制，有利于多用户的访问与共享
- 影像数据和元数据集成到一起，能方便地进行交互式查询
- 对 Client/Server 的分布式应用支持较好，网络性能和数据传输速度都有提高
- 影像数据访问只能通过数据库驱动结构访问，有利于数据的一致性和完整性控制，数据不会被随意移动、修改和删除
- 支持异构的网络模式，即应用程序和后台数据库服务器可以再不同操作系统平台下运行。现有商用数据库都有良好多的网络通信机制，本身能够实现异构网络的分布式计算，使得应用程序的开发相对简单化。

## 时空大数据的管理

### 时空大数据的来源

随着计算机技术、物联网、移动通信以及遥感技术的进一步的发展和完善，人类进入了一个前所未有的数据大爆炸时代。许多与地理位置、时间相关的时空大数据在数据管理方面给传统的 GIS 数据管理带来了挑战和机遇，一些应对时空大数据管理的方法和技术应运而生，时空大数据来源于以下几个方面：

- 基础测绘数据与专题数据
- 遥感影像数据
- 导航定位数据
- 互联网以及物联网数据

### 时空大数据的管理

时空大数据的存储管理，不能仅仅考虑或重点考虑数据存储层面的问题。必须从整个时空大数据平台入手展开顶层设计。既要考虑多源异构大数据的接入，组织、提取，又要考虑分析过程数据、分析结果数据的协调和组织。
![关系数据库模型](/images/geometry/5-空间数据库/img69.png)

### 空间数据引擎

之前采用干洗数据库与稳健混合管理模式的传统 GIS 数据库系统技术，在应用上取得了一定的成功，但不得不部分的采用文件方式管理，总体上无法达到数据库技术冗余度、独立性等要求，用现代数据库技术统一存放和管理空间数据与属性数据是 GIS 发展的必然趋势。

### 空间数据索引概述

索引是丢数据库表中一列或多列的值进行排序的一种结构，使用索引可以快速访问数据库表中的特定信息。

空间索引是指依据控件对象的位置和形状或控件对象之间的某种空间关系按照一定的顺序排列的一种数据结构，其中包括控件对象的概要信息，如对象的标识、外接矩形及其指向控件对象实体的指针。作为一种辅助性的空间数据结构，空间索引介于空间操作算法和控件对象之间。

1. 对象范围索引
   在记录每个空间实体的坐标时，记录包围每个空间实体的外接矩形的最大最小坐标。这样，在检索空间实体时，根据空间实体的最大最小范围，预先排除那些没有落入检索窗口内的空间实体，仅对那些外接矩形落在检索窗口的空间实体做进一步的判断，最后检索出那些真正落入窗口内的空间实体。
   ![关系数据库模型](/images/geometry/5-空间数据库/img70.png)
2. 网格索引
   网格型空间索引思路比较简单，容易理解和实现。其基本思想是将研究区域用横竖线条划分大小相等和不等的网格，记录每一个网格所包含的空间实体。当用户进行空间查询时，首先计算出用户查询对象所在格网，然后再改格网中快速查询所选空间实体，这样一来就大大地加速了空间索引的查询速度。
   ![关系数据库模型](/images/geometry/5-空间数据库/img71.png)
3. 四叉树空间索引
   四叉树作为一种有效的数据结构，不仅可以用来对栅格数据进行组织，他还可用于建立空间数据的索引。四叉树中的线性四叉树和层次四叉树都可以用于建立空间索引
   ![关系数据库模型](/images/geometry/5-空间数据库/img72.png)
