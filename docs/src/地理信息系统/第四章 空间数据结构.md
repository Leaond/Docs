# 空间数据结构

空间数据结构是指对空间数据逻辑模型描述的数据组织关系和编排方式的具体实现，对地理信息系统中数据存储、查询检索和应用分析等操作处理的效率有着至关重要的影响。

空间数据结构是地理信息系统沟通信息的桥梁，只有充分理解地理信息系统所采用的特定数据结构，才能正确有效地使用系统。
![](/images/geometry/4-空间数据结构/img10.png)

数据结构即数据组织的形式，是适合于计算机存储、管理和处理的数据逻辑结构。`对空间数据则是地理实体的空间排列方式和相互关系的抽象描述`。

在地里信息系统中描述地理要素和地理现象的空间数据，主要包括空间位置、拓扑关系和属性三方面的内容。
![](/images/geometry/4-空间数据结构/img11.png)
![](/images/geometry/4-空间数据结构/img12.png)

## 矢量数据结构

矢量数据结构对矢量数据模型进行数据的组织。他通过记录实体坐标及其关系，尽可能精确地表示点、线、面等地理实体，坐标空间为连续空间，允许任意位置、长度和面积的精确定义。
![矢量数据结构](/images/geometry/4-空间数据结构/img13.png)
![矢量数据结构](/images/geometry/4-空间数据结构/img14.png)
矢量数据结构直接以几何空间坐标为基础，记录采样点坐标，通过这种数据组织方式，可以得到精美的地图。另外，该结构有着以下优势

- 可以对复杂数据以最小的数据冗余进行存贮
- 数据精度高
- 存储空间小等特点

`矢量数据结构是一种高效的图形数据结构。按其是否明确表示地理空间实体间的空间关系分为实体数据结构和拓扑数据结构两大类。`

**实体数据结构**

实体数据结构也称为 `spaghetti 数据结构`，是指构成多边形边界的各个线段，以多边形为单元进行组织。按照这种数据结构，边界坐标数据和多边形单元实体一一对应，各个多边形边界点都单独编码并记录坐标。

原始多边形 A、B、C、D，可以采用两种结构分别组织。
![实体数据结构](/images/geometry/4-空间数据结构/img15.png)
第一种结构
![实体数据结构](/images/geometry/4-空间数据结构/img16.png)
第二种结构
![实体数据结构](/images/geometry/4-空间数据结构/img17.png)

实体数据结构的缺点

- 响铃多边形的公共边界要数字化两遍，造成数据冗余存储，可能导致输出的公共边界出现间隙或重叠。
- 缺少多边形的邻域信息和图形的拓扑关系
- 岛只作为一个单个图形，没有建立与外界多边形的联系

因此，实体式数据只适用于简单的系统，如计算机地图制图系统。
![多边形异常](/images/geometry/4-空间数据结构/img18.png)

**拓扑数据结构**

拓扑关系是一种对空间结构关系进行明确定义的数学方法。具有拓扑关系的矢量数据结构就是拓扑数据结构。
拓扑数据结构没有固定的格式，还没有形成统一标准，但基本院系相同

他们的共同特点是: 点是相互独立的，点连成线，线构成面。每条线始于起始结点，止于终止结点，并与左右多边形相邻接。

拓扑数据结构最重要的特征是具有拓扑编辑功能；这种拓扑编辑功能，不但能够对数字化原始数据进行自动差错编辑，而且可以自动形成封闭的多边形边界，为由各个单独存储的弧段组成的各类多边形及建立空间数据库奠定基础。
拓扑空间数据结构主要有:`索引式、双重独立编码结构、链状双重独立编码结构`等

**索引式结构**采用树状索引以减少数据冗余并间接增加邻域信息，具体方法是对所有边界点进行数字化，将坐标对以顺序方式存储，由点索引与边界线号相联系，以线索引与各多边形想联系，形成树状索引结构。
![索引式结构](/images/geometry/4-空间数据结构/img19.png)
![索引式结构](/images/geometry/4-空间数据结构/img20.png)

**双重独立编码结构**简称 DIME 编码系统，他是以城市街道为编码主体，他的特点是采用了拓扑编码结构，这种结构最适合于城市信息系统。双重独立编码结构是对图上网状或面妆要锁的任何一条线段，用顺序的两点定义以及相邻多边形来予以定义。
![双重独立编码结构](/images/geometry/4-空间数据结构/img21.png)
![双重独立编码结构](/images/geometry/4-空间数据结构/img22.png)

**链状双重独立编码结构**是对 DIME 数据结构的一种改进。在 DIME 中，一条边只能用直线两端点的序号以及相邻的多边形来表示，而在链状数据结构中，将若干直线段合为一个弧段，每个弧段可以有许多中间点。

网络数据结构

网络数据结构由一组相连的边和交汇点以及连通性规则组成，用于表示现实世界中的网状线性系统。 网络数据结构是 GIS 数据建模和空间分析所必须得一种常用数据结构。采用网络结构进行建模的常见实体包括交通网络系统、电力系统、地下管网系统等

在 GIS 网络建模中，根据网络是否记录位置特征可以将其分为

- 几何网络
- 逻辑网络

![网络数据结构](/images/geometry/4-空间数据结构/img23.png)
以上只是一个简单网络的几何数据结构，在实际应用中，网络建模要复杂得多。在较为复杂的网络中，可能需要考虑方向，还可能包含一级或多级的子节点和边，甚至还需要对转弯规则进行建模，如在道路建模中，某个道路交叉口只能左转弯，智斗需要再网络结构中添加响应的规则。对于简单网络数据结构，其编码方式同实体数据结构和拓扑数据结构的编码方式类似，但在复杂网络数据结构中，考虑的规则较多，其建模的形式也有所不同。

## 栅格数据结构

以规则栅格阵列表示空间对象的数据结构称为栅格数据结构。阵列中每个栅格单元上的数值表示控件对象的属性特征。即栅格阵列中每个单元的行列号确定位置，属性值表示空间 对象的类型、等级等特征。每个栅格单元只能存在一个值。
![栅格数据结构](/images/geometry/4-空间数据结构/img24.png)
`栅格数据结构的显著特点是：属性明显，定位隐含，即数据直接记录属性的指针或属性本身，而所在位置则根据行列号转换为响应的坐标给出，也就是说定位是根据数据在数据集中的位置得到的`。

栅格数据的优缺点：

- 优点：数据结构简单、数据模拟方便
- 缺点：数据量大、难以建立实体间的拓扑关系，通过改变分辨率而减少数据量时精度和信息量同时受损等。

完全栅格数据结构

完全栅格数据结构也称编码，是将栅格看做一个数据矩阵，逐行逐个记录栅格单元的值。这是最简单最直接的一种栅格编码方式。通常这种编码为栅格文件或网格文件，他不采用任何压缩数据的处理。
完全栅格数据的组织有三种基本方式

- 基于像元
- 基于层
- 基于面域
  ![完全栅格数据结构](/images/geometry/4-空间数据结构/img25.png)

压缩栅格数据结构
![压缩栅格数据结构](/images/geometry/4-空间数据结构/img26.png)
![压缩栅格数据结构](/images/geometry/4-空间数据结构/img27.png)
![压缩栅格数据结构](/images/geometry/4-空间数据结构/img28.png)
线性四叉树

- 线性四叉树则只存储最后叶子结点的信息，包括叶节点的位置编码、属性或灰度值
- 线性四叉树地址码，通常采用十进制 Morton 码（MD 码）
  ![线性四叉树](/images/geometry/4-空间数据结构/img29.png)
  ![MD码](/images/geometry/4-空间数据结构/img30.png)
  ![MD码](/images/geometry/4-空间数据结构/img31.png)
  ![MD码](/images/geometry/4-空间数据结构/img32.png)
  ![MD码](/images/geometry/4-空间数据结构/img33.png)

链码结构

链码数据结构首先采用弗里曼码对栅格中的线或多边形边界进行编码，然后再组织为链码结构
![链码结构](/images/geometry/4-空间数据结构/img34.png)
特征码是指地物的特征码，表示地物的属性值。

映像与瓦片金字塔结构

影像金字塔结构用于图像编码和渐进式图像传输，是一种典型的分层数据结构形式，适合于栅格数据和影像数据的多分辨率组织，也是一种栅格数据或影像数据的有损压缩方式，由 M-金字塔，T-金字塔等。
![链码结构](/images/geometry/4-空间数据结构/img35.png)
![链码结构](/images/geometry/4-空间数据结构/img36.png)
无论由多少切片组成，其分辨率都保持不变，因此任何级别的请求都可以看到相同分辨率的切片服务。

### 矢量数据和栅格数据结构的比较

![矢量数据和栅格数据结构的比较](/images/geometry/4-空间数据结构/img37.png)
从上图来看，大体上矢量数据的优点恰好是栅格数据的缺点，反之亦然。

## 矢栅数据一体化数据结构

矢栅数据一体化数据结构将地理区域划分成多级网格：粗网格、基本网格、细分网格。

三级网格都采用线性四叉树编码用(M0、M1、M2)表示，其中 M0 表示点或线所用过的粗网格的 MD 码，是研究区的整体编码；M1 表示点或线所通过的基本网格的 Morton 码，也是研究区的整体编码；M2 表示点或线所通过的细分格网的 Morton 码，是基本栅格内的局部编码。
![矢栅数据一体化数据结构](/images/geometry/4-空间数据结构/img38.png)
![矢栅数据一体化数据结构](/images/geometry/4-空间数据结构/img39.png)

**矢量数据与栅格数据的融合与转换**

矢量数据到栅格数据的结构转换

矢量数据转换为栅格数据之前，需要线确定栅格像元的大小、像元值分配类型以及分配原则。

栅格像元的大小决定了数据的输出精度。像元值的分配类型和分配原则主要用于确定多个对象落入到同一个像元中时像元值的计算方式。
![矢栅数据一体化数据结构](/images/geometry/4-空间数据结构/img40.png)

1. 线的转换 ： 八方向栅格化法：核心是对任一直线段如何转换成栅格数据
   ![矢栅数据一体化数据结构](/images/geometry/4-空间数据结构/img41.png)
   为了避免转换后栅格像元线段可能出现间断现象，分两种情况判断
   ![矢栅数据一体化数据结构](/images/geometry/4-空间数据结构/img42.png)

2. 面的转换：核心是将多边形矢量区域以及内部转换成栅格数据
   ![矢栅数据一体化数据结构](/images/geometry/4-空间数据结构/img43.png)
   计算栅格图形每行中心线与面边界的交点，对交点进行排序、配对。并对本面域的栅格属性值去填充每对交点之间的栅格。

栅格数据到矢量数据的结构转换

二值化处理：在栅格图像灰度级的最大值和最小值之间选取一个阈值，当灰度级小于阈值时，取值为 0，当灰度级大于阈值时，取值为 1.
点的转换：设栅格点行列号为 I J，相应栅格中心点的矢量坐标为 P(X,Y)
![矢栅数据一体化数据结构](/images/geometry/4-空间数据结构/img44.png)

线的转换：线状栅格图像往往具有一定的宽度，且往往宽窄不一，需要先细化处理，提取中轴线的基础上再矢量化，包括细化、跟踪和拓扑化过程。

通过 3*3 的像元窗口确定细化：凡是去掉后不会影响原栅格图像拓扑连通性的栅格都应该去掉。3*3 的像元阵列共有 2 的 8 次方种情况，经过旋转、去除相同情况，共有 51 种，其中，只有一部分是可以去掉中心点。
![矢栅数据一体化数据结构](/images/geometry/4-空间数据结构/img45.png)
![矢栅数据一体化数据结构](/images/geometry/4-空间数据结构/img46.png)
![矢栅数据一体化数据结构](/images/geometry/4-空间数据结构/img47.png)

面的转换：面妆栅格数据向矢量数据转换只需要进行轮廓转换即可。

- 以面妆栅格影像边缘的一个像素为起点并记下按照点转换方法所得的(x,y)坐标
- 检测其 8 邻域，以找到下一个相邻的边缘像元作为新的起点，并记下其(x,y)坐标
- 重复该跟踪过程知道结束

**镶嵌数据结构**

- 以正方形和矩形单元进行地理空间划分的规则镶嵌数据模型，采用栅格数据结构进行数据的组织；
- Voronoi 多边形和 TIN 三角网采用专门的额数据结构进行数据组织。
  ![Voronoi数据结构](/images/geometry/4-空间数据结构/img48.png)
  Voronoi 数据结构
  ![TIN三角网结构](/images/geometry/4-空间数据结构/img49.png)
  TIN 三角网结构-以三角网为基本对象
  ![TIN三角网结构](/images/geometry/4-空间数据结构/img50.png)
  TIN 三角网结构-以结点为基本对象
  **多维数据结构**
  现实世界呈现给我们的是一个三维甚至是多维的地理场景。例如、严格意义上将，温度不仅在二维空间分布上存在差异，随着海拔的省高，气温也会组件下降。这里就会涉及到三个维度，但是，三个维度只能表示某个时候任意位置的气温，而无法表示随时间的动态变化特征，这就需要添加第四个维度---时间维度，从而形成了一个四维数据模型。

如果以 Z 轴分别表示高程 H 和时间 T，则时空间可以用离散和连续两种方式表达
![TIN三角网结构](/images/geometry/4-空间数据结构/img51.png)

八叉树数据结构

八叉树数据结构可以看成是二维栅格数据黄总的四叉树在三维空间的推广。该数据结构是将所要表示的三维空间 V 按 XYZ 三个方向从中间进行分割，把 V 分割成 8 个立方体；然后根据每个立方体中所含的目标来决定是否对立方体继续进行 8 等分的划分，一直划分到每个立方体被一个目标所充满，或是没有目标，或其大小已经成为预先定义的不可再分的体素为止。
![TIN三角网结构](/images/geometry/4-空间数据结构/img52.png)
![TIN三角网结构](/images/geometry/4-空间数据结构/img53.png)

三维边界表示法

通过指定定点位置、构成边的顶点以及构成面的边来表示三维物体的方法被称为三维边界表示法
![三维边界表示法](/images/geometry/4-空间数据结构/img54.png)
